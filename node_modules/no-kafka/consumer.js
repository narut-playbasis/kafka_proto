"use strict";

var Promise = require('bluebird');
// var _ = require('lodash');

var Kafka = require('./lib/index');
var consumer = new Kafka.SimpleConsumer();

consumer.on('data', function (messageSet) {
    messageSet.forEach(function (m) {
        console.log(m.message.value.toString('utf8'));
    });
});

return consumer.init()
.then(function () {
    return Promise.all([
        consumer.subscribe('kafka-test-topic', 0, {
            time: Kafka.EARLIEST_OFFSET
        }),
        consumer.subscribe('kafka-test-topic', 1, {
            time: Kafka.EARLIEST_OFFSET
        }),
        Promise.delay(500).then(function () {
            return consumer.end();
        })
    ]);
})
.then(function () {
    return consumer.client.describeGroupRequest('no-kafka-group-v0.9').then(function (result) {
      console.log(result.members[0]);
    });
})
.delay(1000)
.then(function () {
    // return consumer.end();
})
.then(function () {
    // console.log('ended');
})
.catch({_kafka_connection_closed: true}, function () {
    console.log('Connection closed');
})
.catch(function (err) {
    Kafka.error(err);
    process.exit(255);
});

